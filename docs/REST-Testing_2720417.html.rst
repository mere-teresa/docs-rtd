#. `eZ Publish Platform 5.<next> <index.html>`__
#. `eZ Publish Platform
   Documentation <eZ-Publish-Platform-Documentation_1114149.html>`__
#. `Development & Administration Guides <6291674.html>`__
#. `Using eZ Publish as a Service
   Platform <Using-eZ-Publish-as-a-Service-Platform_2720526.html>`__
#. `Hacking the REST API <Hacking-the-REST-API_2720423.html>`__

eZ Publish Platform 5.<next> : REST Testing
===========================================

Added by toby.schlitt@ez.no , edited by ricardo.correia@ez.no on May 21,
2013

Setup
=====

This section describes how to set up a REST server for **testing** (note
that this server is not suitable for production use!) against the
integration test suite.

In ezpublish-kernel\ ``/eZ/Publish/Core/REST/Server`` you find an
``index.php``, which is used as the server end-point for testing the
REST API. This index.php realizes a complete setup of the REST API,
including mechanisms adjusted for running the integration test suite,
as:

-  a special authenticator, which receives the logged in user through a
   custom header
-  a rudimentary session management, which allows to keep the database
   state between requests (for tests that execute multiple requests)

In order to run the integration test suite, you need to set up the
following 2 components on your machine:

#. A web server that redirects all requests on a certain port to the
   ``index.php``

   -  the default configured URL is http://localhost:8042/
   -  to change this, edit the constant at the top of
      ezpublish-kernel\ ``/eZ/Publish/Core/REST/common.php``

#. a (persistent) database, including a user with permissions to
   manipulate structure and data (e.g. MySQL)

   -  the server expects the data source name (DSN) to be configured in
      the environment variable ``DATABASE``
   -  set the DSN according to your set up, e.g. to
      ``mysql://root@localhost/ezp-test``
   -  **NOTE**: **The database will be completely overwritten by the
      tests!**

If you have **PHP 5.4** or higher installed, you can start a server as
easy as

-  go to the ezpublish-kernel\ ``/eZ/Publish/Core/REST/Server``
   directory on the shell
-  run ``$ DATABSE="<your dsn>" ./startTestServer.sh``

If you have **PHP 5.3**, you need to setup the web server manually, e.g.
using Apache or a similar web server

Running the tests
=================

Once you have the server running as described above, you can run the
integration test suite against the server.

To do so, go to the shell into the directory
ezpublish-kernel/eZ/Publish/API/Repository/Tests. Here you find 2
phpunit.xml files for this purpose:

-  ``phpunit-rest-xml.xml``
   runs the integration tests against REST using XML encoding
-  ``phpunit-rest-json.xml``
   runs the integration tests against REST using JSON encoding

In order to run one of these test sets, simply type

``$ phpunit -c phpunit-rest-xml.xml``

or

``$ phpunit -c phpunit-rest-json.xml``

This should give you a complete test run against the REST server.

Document generated by Confluence on Feb 12, 2014 16:43

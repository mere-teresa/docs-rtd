

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>eZ Publish Platform 5.&lt;next&gt; : Virtual host example &mdash; Doc eZ Publish 2014 1.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Doc eZ Publish 2014 1.0 documentation" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="../index.html">Doc eZ Publish 2014 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <ol class="arabic simple">
<li><a class="reference external" href="index.html">eZ Publish Platform 5.&lt;next&gt;</a></li>
<li><a class="reference external" href="eZ-Publish-Platform-Documentation_1114149.html">eZ Publish Platform
Documentation</a></li>
<li><a class="reference external" href="Installation-and-Upgrade-Guides_6292016.html">Installation and Upgrade
Guides</a></li>
<li><a class="reference external" href="Installation_7438500.html">Installation</a></li>
<li><a class="reference external" href="Virtual-host-setup_7438507.html">Virtual host setup</a></li>
</ol>
<div class="section" id="ez-publish-platform-5-next-virtual-host-example">
<h1>eZ Publish Platform 5.&lt;next&gt; : Virtual host example<a class="headerlink" href="#ez-publish-platform-5-next-virtual-host-example" title="Permalink to this headline">¶</a></h1>
<p>Added by <a class="reference external" href="mailto:andrea&#46;melo&#37;&#52;&#48;ez&#46;no">andrea<span>&#46;</span>melo<span>&#64;</span>ez<span>&#46;</span>no</a> , edited by <a class="reference external" href="mailto:ricardo&#46;correia&#37;&#52;&#48;ez&#46;no">ricardo<span>&#46;</span>correia<span>&#64;</span>ez<span>&#46;</span>no</a> on Sep 25,
2013</p>
<p>This example demonstrates how to set up a virtual host on the Apache web
server for an eZ Publish installation located in
&#8220;<tt class="docutils literal"><span class="pre">/var/www/example</span></tt>&#8221;. Let&#8217;s say that we want to access eZ Publish by
using the following URLs:</p>
<ul class="simple">
<li><a class="reference external" href="http://www.example.com">http://www.example.com</a> (actual website for public access)</li>
<li><a class="reference external" href="http://admin.example.com">http://admin.example.com</a> (administration interface for the webmaster)</li>
</ul>
<p>In order to achieve this, we need to set up both eZ Publish and the web
server so that they respond correctly to the different requests.</p>
<div class="section" id="ez-publish-configuration-siteaccess-settings">
<h2>eZ Publish configuration: siteaccess settings<a class="headerlink" href="#ez-publish-configuration-siteaccess-settings" title="Permalink to this headline">¶</a></h2>
<p>eZ Publish needs to be configured to use the host access method. This
can be done from within the web based setup wizard or by manually
editing the global override for the site.ini configuration file:
&#8220;<tt class="docutils literal"><span class="pre">&lt;eZ</span> <span class="pre">Publish</span> <span class="pre">root&gt;/ezpublish_legacy/settings/override/site.ini.append.php</span></tt>&#8221;.
A typical legacy configuration would look something like this:</p>
<div class="highlight-python"><pre>...
[SiteAccessSettings]
AvailableSiteAccessList[]
AvailableSiteAccessList[]=example
AvailableSiteAccessList[]=example_admin
MatchOrder=host

HostMatchMapItems[]=www.example.com;example
HostMatchMapItems[]=admin.example.com;example_admin
...</pre>
</div>
<p>This configuration tells eZ Publish that it should use the
&#8220;<tt class="docutils literal"><span class="pre">example</span></tt>&#8221; siteaccess if a request starts with
&#8220;<tt class="docutils literal"><span class="pre">www.example.com</span></tt>&#8221; and &#8220;<tt class="docutils literal"><span class="pre">example_admin</span></tt>&#8221; if the request starts
with &#8220;<tt class="docutils literal"><span class="pre">admin.example.com</span></tt>&#8221;. For more information about site
management in eZ Publish, please refer to the &#8220;<a class="reference external" href="http://doc.ez.no/eZ-Publish/Technical-manual/5.x/Concepts-and-basics/Configuration/Site-management">Site
management</a>&#8221;
part of the &#8220;Concepts and basics&#8221; chapter.</p>
<p>Icon</p>
<p>The legacy configuration above will only work if the same is also
configured in Symfony,&nbsp;by adding our <a class="reference external" href="https://confluence.ez.no/display/EZP/Siteaccess+Matching#SiteaccessMatching-Configuration">available
siteaccesses</a>
and <a class="reference external" href="https://confluence.ez.no/display/EZP/Siteaccess+Matching#SiteaccessMatching-Compoundsiteaccessmatcher">mapping our
hosts</a>
to the desired siteaccess in <strong>ezpublish/config/ezpublish.yml</strong>. This
approach is recommended!</p>
<p>A Symfony based eZ Publish 5 configuration would look something like
this:</p>
<p><strong>ezpublish.yml</strong></p>
</div>
<div class="section" id="apache-configuration-virtual-host-settings">
<h2>Apache configuration: virtual host settings<a class="headerlink" href="#apache-configuration-virtual-host-settings" title="Permalink to this headline">¶</a></h2>
<p>Assuming that...</p>
<ul class="simple">
<li>eZ Publish is located in &#8220;<tt class="docutils literal"><span class="pre">/var/www/example</span></tt>&#8220;</li>
<li>the server&#8217;s IP address is <tt class="docutils literal"><span class="pre">128.39.140.28</span></tt></li>
<li>we wish to access eZ Publish using &#8220;<tt class="docutils literal"><span class="pre">www.example.com</span></tt>&#8221; and
&#8220;<tt class="docutils literal"><span class="pre">admin.example.com</span></tt>&#8220;</li>
</ul>
<p>...the following virtual host configuration needs to be added at the end
of &#8220;<tt class="docutils literal"><span class="pre">http.conf</span></tt>&#8221;:</p>
<div class="highlight-python"><pre>NameVirtualHost 128.39.140.28

&lt;VirtualHost 128.39.140.28&gt;
    &lt;Directory /var/www/example/web&gt;
        Options FollowSymLinks
        AllowOverride None
    &lt;/Directory&gt;

    # Environment.
    # Possible values: "prod" and "dev" out-of-the-box, other values possible with proper configuration
    # Defaults to "prod" if omitted
    SetEnv ENVIRONMENT "prod"

    # Whether to use Symfony's ApcClassLoader.
    # Possible values: 0 or 1
    # Defaults to 0 if omitted
    #SetEnv USE_APC_CLASSLOADER 0

    # Prefix used when USE_APC_CLASSLOADER is set to 1.
    # Use a unique prefix in order to prevent cache key conflicts
    # with other applications also using APC.
    # Defaults to "ezpublish" if omitted
    #SetEnv APC_CLASSLOADER_PREFIX "ezpublish"

    # Whether to use debugging.
    # Possible values: 0 or 1
    # Defaults to 0 if omitted, unless ENVIRONMENT is set to: "dev"
    #SetEnv USE_DEBUGGING 0

    # Whether to use Symfony's HTTP Caching.
    # Disable it if you are using an external reverse proxy (e.g. Varnish)
    # Possible values: 0 or 1
    # Defaults to 1 if omitted, unless ENVIRONMENT is set to: "dev"
    #SetEnv USE_HTTP_CACHE 1

    # Defines the proxies to trust.
    # Separate entries by a comma
    # Example: "proxy1.example.com,proxy2.example.org"
    # By default, no trusted proxies are set
    #SetEnv TRUSTED_PROXIES "127.0.0.1"

    &lt;IfModule mod_php5.c&gt;
        php_admin_flag safe_mode Off
        php_admin_value register_globals    0
        php_value magic_quotes_gpc  0
        php_value magic_quotes_runtime  0
        php_value allow_call_time_pass_reference 0
    &lt;/IfModule&gt;

    DirectoryIndex index.php

    &lt;IfModule mod_rewrite.c&gt;
        RewriteEngine On

        # CVE-2012-6432
        RewriteRule ^/_internal - [R=403,L]

        # Uncomment in FastCGI mode, to get basic auth working.
        #RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]
        # v1 rest API is on Legacy
        RewriteRule ^/api/[^/]+/v1/ /index_rest.php [L]

        # If using cluster, uncomment the following two lines:
        #RewriteRule ^/var/([^/]+/)?storage/images(-versioned)?/.* /index_cluster.php [L]
        #RewriteRule ^/var/([^/]+/)?cache/(texttoimage|public)/.* /index_cluster.php [L]

        RewriteRule ^/var/([^/]+/)?storage/images(-versioned)?/.* - [L]
        RewriteRule ^/var/([^/]+/)?cache/(texttoimage|public)/.* - [L]
        RewriteRule ^/design/[^/]+/(stylesheets|images|javascript|fonts)/.* - [L]
        RewriteRule ^/share/icons/.* - [L]
        RewriteRule ^/extension/[^/]+/design/[^/]+/(stylesheets|flash|images|lib|javascripts?)/.* - [L]
        RewriteRule ^/packages/styles/.+/(stylesheets|images|javascript)/[^/]+/.* - [L]
        RewriteRule ^/packages/styles/.+/thumbnail/.* - [L]
        RewriteRule ^/var/storage/packages/.* - [L]

        # Makes it possible to place your favicon at the root of your
        # eZ Publish instance. It will then be served directly.
        RewriteRule ^/favicon\.ico - [L]
        # Uncomment the line below if you want you favicon be served
        # from the standard design. You can customize the path to
        # favicon.ico by changing /design/standard/images/favicon\.ico
        #RewriteRule ^/favicon\.ico /design/standard/images/favicon.ico [L]
        RewriteRule ^/design/standard/images/favicon\.ico - [L]

        # Give direct access to robots.txt for use by crawlers (Google,
        # Bing, Spammers..)
        RewriteRule ^/robots\.txt - [L]

        # Platform for Privacy Preferences Project ( P3P ) related files
        # for Internet Explorer
        # More info here : http://en.wikipedia.org/wiki/P3p
        RewriteRule ^/w3c/p3p\.xml - [L]

        # Uncomment the following lines when using popup style debug in legacy
        #RewriteRule ^/var/([^/]+/)?cache/debug\.html.* - [L]

        # Following rule is needed to correctly display assets from eZ Publish5 / Symfony bundles
        RewriteRule ^/bundles/ - [L]

        # Additional Assetic rules for eZ Publish 5.1 / 2013.4 and higher:
        ## Don't forget to run php ezpublish/console assetic:dump --env=prod
        ## and make sure to comment these out in dev environment.
        RewriteRule ^/css/.*\.css - [L]
        RewriteRule ^/js/.*\.js - [L]

        RewriteRule .* /index.php
    &lt;/IfModule&gt;

    DocumentRoot /var/www/example/web
    ServerName www.example.com
    ServerAlias admin.example.com
&lt;/VirtualHost&gt;</pre>
</div>
<p>Icon</p>
<p>For instructions on how to set custom environments please refer to
the&nbsp;<a class="reference external" href="Installing-eZ-Publish-on-a-Linux-UNIX-based-system_7438581.html">Installing eZ Publish on a Linux-UNIX based
system</a>
documentation page, under &#8220;Defining the desired environment&#8221;.</p>
<p>Icon</p>
<p>Note that it isn&#8217;t necessary to create a separate virtual host block for
&#8220;<tt class="docutils literal"><span class="pre">admin.example.com</span></tt>&#8221;, it can be added to the existing block using
the &#8220;<tt class="docutils literal"><span class="pre">ServerAlias</span></tt>&#8221; directive&nbsp;which&nbsp;can take several
values&nbsp;separated&nbsp;by a space.</p>
</div>
<div class="section" id="comments">
<h2>Comments:<a class="headerlink" href="#comments" title="Permalink to this headline">¶</a></h2>
<p>I think this:&nbsp;<tt class="docutils literal"><span class="pre">RewriteRule</span> <span class="pre">^/bundles/</span> <span class="pre">-</span> <span class="pre">[L]</span></tt></p>
<p>Needs to become this&nbsp;<tt class="docutils literal"><span class="pre">RewriteRule</span> <span class="pre">^bundles/</span> <span class="pre">-</span> <span class="pre">[L]</span></tt></p>
<p>When apache2 is used. The first one seems to work for apache1</p>
<p><img alt="image0" src="docs/images/icons/contenttypes/comment_16.png" /> Posted by arnottg at Oct 30, 2013 10:29</p>
<p>Dear Gareth,</p>
<p>The virtual host configuration setting is correct as it is (with the
slash), and works properly on apache2.</p>
<p>Only in .htaccess configurations the slash should be removed.</p>
<p>Hope this helps on clarifying.</p>
<p><img alt="image1" src="docs/images/icons/contenttypes/comment_16.png" /> Posted by <a class="reference external" href="mailto:ricardo&#46;correia&#37;&#52;&#48;ez&#46;no">ricardo<span>&#46;</span>correia<span>&#64;</span>ez<span>&#46;</span>no</a> at Oct 30, 2013 11:00</p>
<p>Document generated by Confluence on Feb 12, 2014 16:43</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">eZ Publish Platform 5.&lt;next&gt; : Virtual host example</a><ul>
<li><a class="reference internal" href="#ez-publish-configuration-siteaccess-settings">eZ Publish configuration: siteaccess settings</a></li>
<li><a class="reference internal" href="#apache-configuration-virtual-host-settings">Apache configuration: virtual host settings</a></li>
<li><a class="reference internal" href="#comments">Comments:</a></li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/docs/Virtual-host-example_7438569.html.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li><a href="../index.html">Doc eZ Publish 2014 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, eZ Systems.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>
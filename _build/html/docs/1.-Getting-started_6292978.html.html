

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>eZ Publish Platform 5.&lt;next&gt; : 1. Getting started &mdash; Doc eZ Publish 2014 1.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Doc eZ Publish 2014 1.0 documentation" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="../index.html">Doc eZ Publish 2014 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <ol class="arabic simple">
<li><a class="reference external" href="index.html">eZ Publish Platform 5.&lt;next&gt;</a></li>
<li><a class="reference external" href="eZ-Publish-Platform-Documentation_1114149.html">eZ Publish Platform
Documentation</a></li>
<li><a class="reference external" href="6291674.html">Development &amp; Administration Guides</a></li>
<li><a class="reference external" href="eZ-Publish-Public-API_1736723.html">eZ Publish Public API</a></li>
<li><a class="reference external" href="Public-API-Cookbook_5046311.html">Public API Cookbook</a></li>
</ol>
<div class="section" id="ez-publish-platform-5-next-1-getting-started">
<h1>eZ Publish Platform 5.&lt;next&gt; : 1. Getting started<a class="headerlink" href="#ez-publish-platform-5-next-1-getting-started" title="Permalink to this headline">¶</a></h1>
<p>Added by <a class="reference external" href="mailto:bertrand&#46;dunogier&#37;&#52;&#48;ez&#46;no">bertrand<span>&#46;</span>dunogier<span>&#64;</span>ez<span>&#46;</span>no</a> , edited by <a class="reference external" href="mailto:ricardo&#46;correia&#37;&#52;&#48;ez&#46;no">ricardo<span>&#46;</span>correia<span>&#64;</span>ez<span>&#46;</span>no</a> on
Aug 02, 2013</p>
<p>With the introduction of Symfony 2 as the framework powering eZ Publish
5, the whole eZ Publish 4.x extensions system is changing. Pretty much
everything needs to be done with entirely new concepts. In this chapter,
we will see two ways of customizing eZ Publish 5: command line scripts
(for import scripts, for instance), and custom controllers, the eZ
Publish 5 equivalent of eZ Publish 4.x custom modules.</p>
<ul class="simple">
<li><a class="reference external" href="#id-1.Gettingstarted-Symfonybundle">Symfony bundle</a><ul>
<li><a class="reference external" href="#id-1.Gettingstarted-Generatinganewbundle">Generating a new
bundle</a></li>
<li><a class="reference external" href="#id-1.Gettingstarted-Creatingacommandlinescriptinyourbundle">Creating a command line script in your
bundle</a></li>
<li><a class="reference external" href="#id-1.Gettingstarted-Creatingacustomroutewithacontrolleraction">Creating a custom route with a controller
action</a><ul>
<li><a class="reference external" href="#id-1.Gettingstarted-routing.yml">routing.yml</a></li>
<li><a class="reference external" href="#id-1.Gettingstarted-DefaultController.php">DefaultController.php</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="section" id="symfony-bundle">
<h2>Symfony bundle<a class="headerlink" href="#symfony-bundle" title="Permalink to this headline">¶</a></h2>
<p>In order to test and use Public API code, you will need to build a
custom bundle. Bundles are Symfony&#8217;s extensions, and are therefore also
used to extend eZ Publish. Symfony 2 provides code generation tools that
will let you create your own bundle and get started in a few minutes.</p>
<p>In this chapter, we will show how to create a custom bundle, and
implement both: a command line script and a custom route with its own
controller action and view. All shell commands assume that you use some
Linux shell, but those commands would of course also work on Windows
systems.</p>
<div class="section" id="generating-a-new-bundle">
<h3>Generating a new bundle<a class="headerlink" href="#generating-a-new-bundle" title="Permalink to this headline">¶</a></h3>
<p>First, change the directory to your eZ Publish root.</p>
<p>Then use the app/console application with the <tt class="docutils literal"><span class="pre">generate:bundle</span></tt>
command to start the bundle generation wizard.</p>
<p>Let&#8217;s follow the instructions provided by the wizard. Our objective is
to create a bundle named&nbsp;<tt class="docutils literal"><span class="pre">EzSystems/Bundles/CookBookBundle</span></tt>, located
in the&nbsp;<a href="#id1"><span class="problematic" id="id2">``</span></a>src``&nbsp;directory.</p>
<p>The wizard will first ask about our bundle&#8217;s namespace. Each bundle&#8217;s
namespace should feature a vendor name (in our own
case:&nbsp;<tt class="docutils literal"><span class="pre">EzSystems</span></tt>), optionally followed by a sub-namespace (we could
have chosen to use&nbsp;<tt class="docutils literal"><span class="pre">Bundle</span></tt>), and end with the actual bundle&#8217;s name,
suffixed with Bundle:&nbsp;<tt class="docutils literal"><span class="pre">CookbookBundle</span></tt>.</p>
<p><strong>Bundle namespace</strong></p>
<p>You will then be asked about the Bundle&#8217;s name, used to reference your
bundle in your code. We can go with the
default,&nbsp;<tt class="docutils literal"><span class="pre">EzSystemsCookbookBundle</span></tt>. Just hit enter to accept the
default.</p>
<p><strong>Bundle name</strong></p>
<p>The next question is your bundle&#8217;s location. By default, the script
offers to place it in the&nbsp;<a href="#id3"><span class="problematic" id="id4">``</span></a>src``&nbsp;folder. This is perfectly acceptable
unless you have a good reason to place it somewhere else. Just hit enter
to accept the default.</p>
<p><strong>Bundle directory</strong></p>
<p>Next, you need to choose the generated configuration&#8217;s format, out of
YAML, XML, PHP or annotations. We mostly use yaml in eZ Publish 5, and
we will use it in this cookbook. Enter &#8216;yml&#8217;, and hit enter.</p>
<p><strong>Configuration format</strong></p>
<div class="line-block">
<div class="line">The last choice is to generate code snippets demonstrating the Symfony</div>
</div>
<p>directory structure. If you&#8217;re learning Symfony, it is a good idea to
accept, as it will pre-create a controller, yaml files, etc.</p>
<p><strong>Generate snippets &amp; directory structure</strong></p>
<p>The generator will then summarize the previous choices, and ask for
confirmation. Hit enter to confirm.</p>
<p><strong>Summary and confirmation</strong></p>
<p>The wizard will generate the bundle, check autoloading, and ask about
the activation of your bundle. Hit enter to both questions to have your
bundle automatically added to your Kernel
(<tt class="docutils literal"><span class="pre">ezpublish/EzPublishKernel.php</span></tt>) and routes from your bundle added to
the existing routes (<tt class="docutils literal"><span class="pre">ezpublish/config/routing.yml</span></tt>).</p>
<p><strong>Activation and generation</strong></p>
<p>Your bundle should be generated and activated. Let&#8217;s now see how you can
interact with the Public API by creating a command line script, and a
custom controller route and action.</p>
</div>
<div class="section" id="creating-a-command-line-script-in-your-bundle">
<h3>Creating a command line script in your bundle<a class="headerlink" href="#creating-a-command-line-script-in-your-bundle" title="Permalink to this headline">¶</a></h3>
<p>Writing a command line script with Symfony 2 is&nbsp;<em>very</em>&nbsp;easy. The
framework and its bundles ship with a few scripts. They are all started
using&nbsp;<a href="#id5"><span class="problematic" id="id6">``</span></a>php ezpublish/console &lt;command&gt;``&nbsp;(<a href="#id7"><span class="problematic" id="id8">``</span></a>app/console``&nbsp;in a
default symfony 2 application). You can get the complete list of
existing command line scripts by
executing&nbsp;<a href="#id9"><span class="problematic" id="id10">``</span></a>php ezpublish/console list``&nbsp;from the eZ Publish 5 root.</p>
<p>In this chapter, we will create a new command, identified
as&nbsp;<tt class="docutils literal"><span class="pre">ezpublish:cookbook:hello</span></tt>, that takes an optional name argument,
and greets that name. To do so, we need one thing: a class with a name
ending with &#8220;Command&#8221; that
extends&nbsp;<tt class="docutils literal"><span class="pre">Symfony\Component\Console\Command\Command</span></tt>. Note that in
our case, we use&nbsp;<tt class="docutils literal"><span class="pre">ContainerAwareCommand``&nbsp;instead</span> <span class="pre">of&nbsp;\</span> <span class="pre">``Command</span></tt>,
since we need the dependency injection container to interact with the
Public API).&nbsp;In your bundle&#8217;s directory
(<tt class="docutils literal"><span class="pre">src/EzSystems/CookbookBundle</span></tt>), create a new directory
named&nbsp;<tt class="docutils literal"><span class="pre">Command</span></tt>, and in this directory, a new file
named&nbsp;<tt class="docutils literal"><span class="pre">HelloCommand.php</span></tt>.</p>
<p>Add this code to the file:</p>
<p><strong>HelloCommand.php</strong></p>
<p>This is the skeleton for a command line script.</p>
<p>One class with a name ending with &#8220;Command&#8221; (<tt class="docutils literal"><span class="pre">HelloCommand</span></tt>),
extends&nbsp;<tt class="docutils literal"><span class="pre">Symfony\Bundle\FrameworkBundle\Command\Command</span></tt>, and is
part of our bundle&#8217;s Command namespace. It has two
methods:&nbsp;<tt class="docutils literal"><span class="pre">configure()</span></tt>, and&nbsp;<tt class="docutils literal"><span class="pre">execute()</span></tt>. We also import several
classes &amp; interfaces with the use keyword. The first
two,&nbsp;<a href="#id11"><span class="problematic" id="id12">``</span></a>InputInterface``&nbsp;and&nbsp;<a href="#id13"><span class="problematic" id="id14">``</span></a>OutputInterface``&nbsp;are used to &#8216;typehint&#8217;
the objects that will allow us to provide input &amp; output management in
our script.</p>
<p>Configure will be used to set your command&#8217;s name, as well as its
options and arguments. Execute will contain the actual implementation of
your command. Let&#8217;s start by creating the&nbsp;<a href="#id15"><span class="problematic" id="id16">``</span></a>configure()``&nbsp;method.</p>
<p><strong>TestCommand::configure()</strong></p>
<p>First, we use setName() to set our command&#8217;s name to
&#8220;<tt class="docutils literal"><span class="pre">ezpublish:cookbook:hello</span></tt>&#8221;.&nbsp; We then use&nbsp;<tt class="docutils literal"><span class="pre">setDefinition()``&nbsp;to</span>
<span class="pre">add</span> <span class="pre">an</span> <span class="pre">argument,</span> <span class="pre">named&nbsp;\</span> <span class="pre">``name</span></tt>, to our command.</p>
<p>You can read more about arguments definitions and further options in
the&nbsp;<a class="reference external" href="http://symfony.com/doc/2.0/components/console/introduction.html">Symfony 2 Console
documentation</a>.&nbsp;Once
this is done, if you run&nbsp;<tt class="docutils literal"><span class="pre">php</span> <span class="pre">ezpublish/console</span> <span class="pre">list</span></tt>, you should
see&nbsp;<a href="#id17"><span class="problematic" id="id18">``</span></a>ezpublish:cookbook:hello``&nbsp;listed in the available commands. If
you run it, it should just do nothing.</p>
<p>Let&#8217;s just add something very simple to our execute() method so that our
command actually does something.</p>
<p><strong>TestCommand::execute()</strong></p>
<p>You can now run the command from the eZ Publish 5 root.</p>
<p><strong>Hello world</strong></p>
</div>
<div class="section" id="creating-a-custom-route-with-a-controller-action">
<h3>Creating a custom route with a controller action<a class="headerlink" href="#creating-a-custom-route-with-a-controller-action" title="Permalink to this headline">¶</a></h3>
<p>In this short chapter, we will see how to create a new route that will
catch a custom URL and execute a controller action. We want to create a
new route, <tt class="docutils literal"><span class="pre">/cookbook/test</span></tt>, that displays a simple &#8216;Hello world&#8217;
message. This tutorial is a simplified version of the official one that
can be found
on&nbsp;<a class="reference external" href="http://symfony.com/doc/current/book/controller.html">http://symfony.com/doc/current/book/controller.html</a>.</p>
<p>eZ Publish 4 equivalent</p>
<p>Icon</p>
<p>This eZ Publish 5 extension would have been a custom module, with its
own <tt class="docutils literal"><span class="pre">module.php</span></tt> file, in eZ Publish 4.</p>
<p>During our bundle&#8217;s generation, we have chosen to generate the bundle
with default code snippets. Fortunately, almost everything we need is
part of those default snippets. We just need to do some editing, in
particular in two
locations:&nbsp;<tt class="docutils literal"><span class="pre">src/EzSystems/Resources/config/routing.yml``&nbsp;and&nbsp;``src/EzSystems/CookbookBundle/Controllers/DefaultController.php</span></tt>.
The first one will be used to configure our route (<tt class="docutils literal"><span class="pre">/cookbook/test</span></tt>)
as well as the controller action the route should execute, while the
latter will contain the actual action&#8217;s code.</p>
<div class="section" id="routing-yml">
<h4>routing.yml<a class="headerlink" href="#routing-yml" title="Permalink to this headline">¶</a></h4>
<p>This is the file where we define our action&#8217;s URL matching. The
generated file contains this YAML block</p>
<p><strong>Generated routing.yml</strong></p>
<p>We can safely remove this default code, and replace it with this</p>
<p><strong>Edited routing.yml</strong></p>
<p>We define a route that matches the URI /cookbook/* and executes the
action hello in the Default controller of our bundle. The next step is
to create this method in the controller.</p>
</div>
<div class="section" id="defaultcontroller-php">
<h4>DefaultController.php<a class="headerlink" href="#defaultcontroller-php" title="Permalink to this headline">¶</a></h4>
<p>This controller was generated by the bundle generator. It contains one
method,&nbsp;<tt class="docutils literal"><span class="pre">helloAction()</span></tt>, that matched the YAML configuration we have
changed in the previous part. Let&#8217;s just rename
the&nbsp;<a href="#id19"><span class="problematic" id="id20">``</span></a>indexAction()``&nbsp;method so that we end up with this code.</p>
<p><strong>DefaultController::helloAction()</strong></p>
<p>We won&#8217;t go into details about controllers in this cookbook, but let&#8217;s
walk through the code a bit.&nbsp;This method receives the parameter defined
in&nbsp;<tt class="docutils literal"><span class="pre">routing.yml</span></tt>. It is named &#8220;name&#8221; in the route definition, and
must be named $name in the matching action. Since the action is named
&#8220;hello&#8221; in&nbsp;<tt class="docutils literal"><span class="pre">routing.yml</span></tt>, the expected method name
is&nbsp;<tt class="docutils literal"><span class="pre">helloAction</span></tt>.</p>
<p>Controller actions&nbsp;<strong>must</strong>&nbsp;return a Response object that will contain
the response&#8217;s content, the headers, and various optional properties
that affect the action&#8217;s behavior. In our case, we simply set the
content, using&nbsp;<tt class="docutils literal"><span class="pre">setContent()</span></tt>, to &#8220;Hello $name&#8221;. Simple.&nbsp;Go
to&nbsp;<a class="reference external" href="http://ezpublish5/cookbook/hello/YourName,">http://ezpublish5/cookbook/hello/YourName</a>,
and you should get &#8220;Hello YourName&#8221;.</p>
<p>The custom EzPublishCoreBundle Controller</p>
<p>Icon</p>
<p>For convenience, a custom controller is available at
<a class="reference external" href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Bundle/EzPublishCoreBundle/Controller.html">eZ\Bundle\EzPublishCoreBundle\Controller</a>.
It gives you with a few commodity methods:</p>
<ul class="simple">
<li>getRepository()
Returns the Public API repository, that gives you access to the
various services through getContentService(), getLocationService()
and so on;</li>
<li>getLegacyKernel()
Returns&nbsp;an instance of the
<a class="reference external" href="http://apidoc.ez.no/doxygen/trunk/NS/html/classeZ_1_1Publish_1_1Core_1_1MVC_1_1Legacy_1_1Kernel.html">eZ\Publish\Core\MVC\Legacy\Kernel</a>,
that you can use to interact with the Legacy eZ Publish kernel</li>
<li>getConfigResolver()
Returns the
<a class="reference external" href="http://apidoc.ez.no/doxygen/trunk/NS/html/classeZ_1_1Bundle_1_1EzPublishCoreBundle_1_1DependencyInjection_1_1Configuration_1_1ConfigResolver.html">ConfigResolver</a>
that gives you access to configuration data.</li>
</ul>
<p>You are encouraged to use it for your custom controllers that interact
with eZ Publish.</p>
<p>With both command line scripts and HTTP routes, you have the basics you
need to start writing Public API code.</p>
<p>Document generated by Confluence on Feb 12, 2014 16:43</p>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">eZ Publish Platform 5.&lt;next&gt; : 1. Getting started</a><ul>
<li><a class="reference internal" href="#symfony-bundle">Symfony bundle</a><ul>
<li><a class="reference internal" href="#generating-a-new-bundle">Generating a new bundle</a></li>
<li><a class="reference internal" href="#creating-a-command-line-script-in-your-bundle">Creating a command line script in your bundle</a></li>
<li><a class="reference internal" href="#creating-a-custom-route-with-a-controller-action">Creating a custom route with a controller action</a><ul>
<li><a class="reference internal" href="#routing-yml">routing.yml</a></li>
<li><a class="reference internal" href="#defaultcontroller-php">DefaultController.php</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/docs/1.-Getting-started_6292978.html.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li><a href="../index.html">Doc eZ Publish 2014 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, eZ Systems.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>